<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      .bar_tooltip,
      .line_tooltip,
      .pie_tooltip {
        position: absolute;
        display: none;
        min-width: 80px;
        height: auto;
        background: none repeat scroll;
        border: 1px solid #afafaf;
        padding: 14px;
        text-align: center;
        background-color: white;
        z-index: 1;
      }

      .hovered:hover {
        opacity: 0.7;
      }
      #pie_div {
        display: inline-block;
        background-color: grey;
      }
      font {
        fill: white;
      }
    </style>
  </head>
  <body>
    <div id="pie_div"></div>
  </body>
  <script>
    const data = [40, 27, 13, 67, 88];

    const width = 610,
      height = 500,
      radius = Math.min(width, height) / 3;

    const svg = d3
      .select("body")
      .append("svg")
      .attr("id", "pie_chart")
      .attr("width", width)
      .attr("height", height)
      .style("border", "1px solid black");

    const g = svg
      .append("g")
      .attr("transform", `translate(${width / 3.5}, ${height / 2})`);

    const title = svg
      .append("text")
      .attr("class", "pie-font")
      .attr("x", 320)
      .attr("y", 25)
      .attr("id", "pie_title")
      .attr("text-anchor", "middle")
      .style("font-size", "1.1em")
      .text("Client Demographic");

    const pieScale = d3.scaleOrdinal().range(["#98abc5", "#8a89a6", "#7b6888"]);

    const pie = d3
      .pie()
      //.sort(null)
      .value(function (d) {
        return d;
      });

    const arc = d3
      .arc()
      .outerRadius(radius - 55)
      .innerRadius(0);

    const labelArc = d3
      .arc()
      .outerRadius(radius - 70)
      .innerRadius(radius - -20);

    const arcs = g
      .selectAll(".arc")
      .data(pie(data))
      .enter()
      .append("g")
      .attr("class", "arc");

    arcs
      .append("path")
      .attr("d", arc)
      .attr("stroke", "white")
      .attr("stroke-width", "3")
      .style("fill", function (d) {
        return pieScale(d.data);
      })
      .on("mouseover", function (d) {
        d3.select(this).attr("opacity", "0.7");
      })
      .on("mouseout", function (d) {
        d3.select(this).attr("opacity", "1");
      });

    arcs
      .append("text")
      .attr("transform", function (d) {
        return "translate(" + labelArc.centroid(d) + ")";
      })
      .attr("dy", ".35em")
      .text(function (d) {
        return d.data;
      });

    const tooltip = d3
      .select("body")
      .append("div")
      .attr("class", "pie_tooltip");

    arcs
      .on("mousemove", function (d) {
        tooltip
          .style("left", d3.event.pageX + 10 + "px")
          .style("top", d3.event.pageY + 10 + "px")
          .style("display", "inline-block")
          .html(d.value);
      })
      .on("mouseout", function (d) {
        tooltip.style("display", "none");
      });

    function sortsLegend() {
      data.sort(function (a, b) {
        return a - b;
      });
    }

    sortsLegend();

    let legend = d3
      .select("#pie_chart")
      .append("g")
      .attr("transform", `translate(${460}, ${170})`)
      .attr("id", "legend");

    let pairs = legend
      .selectAll(".pairs")
      .data(data)
      .enter()
      .append("g")
      .attr("class", "pairs");

    let icon = d3
      .selectAll(".pairs")
      .append("rect")
      .attr("height", "10px")
      .attr("width", "10px")
      .style("fill", function (d) {
        return pieScale(d);
      });

    let num = d3
      .selectAll(".pairs")
      .append("text")
      .text(function (d) {
        return d;
      })
      .attr("x", 20)
      .attr("y", 10);

    let i = 0;
    let pair = d3.selectAll(".pairs");

    pair.each(function (p, j) {
      d3.select(this).attr("transform", `translate(${0}, ${(i += 20)})`);
    });
  </script>
</html>
